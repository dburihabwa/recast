# Generated by configure.py on 2017-09-21T15:21:51.355240
---
version: "3"
services:
    load_balancer:
      image: dockercloud/haproxy:1.6.7
      restart: always
      ports:
        - 3000:80
      depends_on:
        - proxy
      links:
        - proxy
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock
      deploy:
        mode: global

    proxy:
        build: ./pyproxy
        env_file:
          - ./erasure.env
        deploy:
            mode: replicated
            placement:
                constraints: [node.role == manager]

    coder:
        build: ./pyproxy
        entrypoint: python /usr/local/src/pyproxy/coder.py
        env_file:
          - ./erasure.env
        deploy:
            mode: replicated
            placement:
                constraints: [node.role == manager]

    zoo1:
        image: zookeeper
        restart: always
        ports:
          - 2181:2181
        environment:
          - ZOO_MY_ID=1
        deploy:
            mode: replicated
            placement:
                constraints: [node.role == manager]

    metadata:
        image: redis:3.2.8
        command: redis-server --appendonly yes
        deploy:
            mode: replicated
            placement:
                constraints: [node.role == manager]
        volumes:
          - ./volumes/metadata/:/data/

    redis:
        image: redis:3.2.8
        deploy:
            placement:
                constraints:
                  - node.role == worker
        command: redis-server --appendonly yes
        volumes:
          - ./volumes/redis/:/data/
        container_name: redis
